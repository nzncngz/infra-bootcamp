### constants
import pandas as pd
from sqlalchemy import create_engine

conn = "postgresql://{{ db_main_user }}:{{ postgre_pass }}@localhost:{{ postgresql_port }}/{{ db_name }}"

file="{{ work_directory }}/traffic_density_202001.csv"
mydata = pd.read_csv(file, header = 0)

engine = create_engine(conn)

# Create an iterable that will read "chunksize=1000" rows
# at a time from the CSV file
for df in pd.read_csv(file,names=mydata, skiprows=1, chunksize=1000):
  df.to_sql(
    '{{ table_name }}',
    engine,
    index=False,
    if_exists='replace' # if the table already exists, append this data
  )
